!function(a,b,c){function f(a){function d(a,b,d){var e={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};e[a]?c[e[a]]=b:d||(c[a]=b)}var b=a.required_features,c={};return"string"==typeof b?g.each(b.split(/\s*,\s*/),function(a){d(a,!0)}):"object"==typeof b?g.each(b,function(a,b){d(b,a)}):b===!0&&(a.multipart||(c.send_binary_string=!0),a.chunk_size>0&&(c.slice_blob=!0),a.resize.enabled&&(c.send_binary_string=!0),g.each(a,function(a,b){d(b,!!a,!0)})),c}var d=a.setTimeout,e={},g={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:b.mimes,ua:b.ua,typeOf:b.typeOf,extend:b.extend,guid:b.guid,get:function(a){var d,e,c=[];for("array"!==b.typeOf(a)&&(a=[a]),e=a.length;e--;)d=b.get(a[e]),d&&c.push(d);return c.length?c:null},each:b.each,getPos:b.getPos,getSize:b.getSize,xmlEncode:function(a){var b={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g;return a?(""+a).replace(c,function(a){return b[a]?"&"+b[a]+";":a}):a},toArray:b.toArray,inArray:b.inArray,addI18n:b.addI18n,translate:b.translate,isEmptyObj:b.isEmptyObj,hasClass:b.hasClass,addClass:b.addClass,removeClass:b.removeClass,getStyle:b.getStyle,addEvent:b.addEvent,removeEvent:b.removeEvent,removeAllEvents:b.removeAllEvents,cleanName:function(a){var b,c;for(c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(a,b){var c="";return g.each(b,function(a,b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}),c&&(a+=(a.indexOf("?")>0?"&":"?")+c),a},formatSize:function(a){function b(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}if(a===c||/\D/.test(a))return g.translate("N/A");var d=Math.pow(1024,4);return a>d?b(a/d,1)+" "+g.translate("tb"):a>(d/=1024)?b(a/d,1)+" "+g.translate("gb"):a>(d/=1024)?b(a/d,1)+" "+g.translate("mb"):a>1024?Math.round(a/1024)+" "+g.translate("kb"):a+" "+g.translate("b")},parseSize:b.parseSizeStr,predictRuntime:function(a,c){var d,e;return d=new g.Uploader(a),e=b.Runtime.thatCan(d.getOption().required_features,c||a.runtimes),d.destroy(),e},addFileFilter:function(a,b){e[a]=b}};g.addFileFilter("mime_types",function(a,b,c){a.length&&!a.regexp.test(b.name)?(this.trigger("Error",{code:g.FILE_EXTENSION_ERROR,message:g.translate("File extension error."),file:b}),c(!1)):c(!0)}),g.addFileFilter("max_file_size",function(a,b,c){var d;a=g.parseSize(a),b.size!==d&&a&&b.size>a?(this.trigger("Error",{code:g.FILE_SIZE_ERROR,message:g.translate("File size error."),file:b}),c(!1)):c(!0)}),g.addFileFilter("prevent_duplicates",function(a,b,c){if(a)for(var d=this.files.length;d--;)if(b.name===this.files[d].name&&b.size===this.files[d].size)return this.trigger("Error",{code:g.FILE_DUPLICATE_ERROR,message:g.translate("Duplicate file error."),file:b}),c(!1),void 0;c(!0)}),g.Uploader=function(a){function r(){var a,c,b=0;if(this.state==g.STARTED){for(c=0;c<j.length;c++)a||j[c].status!=g.QUEUED?b++:(a=j[c],this.trigger("BeforeUpload",a)&&(a.status=g.UPLOADING,this.trigger("UploadFile",a)));b==j.length&&(this.state!==g.STOPPED&&(this.state=g.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",j))}}function s(a){a.percent=a.size>0?Math.ceil(100*(a.loaded/a.size)):100,t()}function t(){var a,b;for(o.reset(),a=0;a<j.length;a++)b=j[a],b.size!==c?(o.size+=b.origSize,o.loaded+=b.loaded*b.origSize/b.size):o.size=c,b.status==g.DONE?o.uploaded++:b.status==g.FAILED?o.failed++:o.queued++;o.size===c?o.percent=j.length>0?Math.ceil(100*(o.uploaded/j.length)):0:(o.bytesPerSec=Math.ceil(o.loaded/((+new Date-n||1)/1e3)),o.percent=o.size>0?Math.ceil(100*(o.loaded/o.size)):0)}function u(){var a=l[0]||m[0];return a?a.getRuntime().uid:!1}function v(a,c){if(a.ruid){var d=b.Runtime.getInfo(a.ruid);if(d)return d.can(c)}return!1}function w(){this.bind("FilesAdded",A),this.bind("CancelUpload",F),this.bind("BeforeUpload",B),this.bind("UploadFile",C),this.bind("UploadProgress",D),this.bind("StateChanged",E),this.bind("QueueChanged",t),this.bind("Error",H),this.bind("FileUploaded",G),this.bind("Destroy",I)}function x(a,c){var d=this,e=0,f=[],h={accept:a.filters.mime_types,runtime_order:a.runtimes,required_caps:a.required_features,preferred_caps:k,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};g.each(a.runtimes.split(/\s*,\s*/),function(b){a[b]&&(h[b]=a[b])}),a.browse_button&&g.each(a.browse_button,function(c){f.push(function(f){var i=new b.FileInput(g.extend({},h,{name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:c}));i.onready=function(){var a=b.Runtime.getInfo(this.ruid);b.extend(d.features,{chunks:a.can("slice_blob"),multipart:a.can("send_multipart"),multi_selection:a.can("select_multiple")}),e++,l.push(this),f()},i.onchange=function(){d.addFile(this.files)},i.bind("mouseenter mouseleave mousedown mouseup",function(d){p||(a.browse_button_hover&&("mouseenter"===d.type?b.addClass(c,a.browse_button_hover):"mouseleave"===d.type&&b.removeClass(c,a.browse_button_hover)),a.browse_button_active&&("mousedown"===d.type?b.addClass(c,a.browse_button_active):"mouseup"===d.type&&b.removeClass(c,a.browse_button_active)))}),i.bind("error runtimeerror",function(){i=null,f()}),i.init()})}),a.drop_element&&g.each(a.drop_element,function(a){f.push(function(c){var f=new b.FileDrop(g.extend({},h,{drop_zone:a}));f.onready=function(){var a=b.Runtime.getInfo(this.ruid);d.features.dragdrop=a.can("drag_and_drop"),e++,m.push(this),c()},f.ondrop=function(){d.addFile(this.files)},f.bind("error runtimeerror",function(){f=null,c()}),f.init()})}),b.inSeries(f,function(){"function"==typeof c&&c(e)})}function y(a,c,d){var e=new b.Image;try{e.onload=function(){e.downsize(c.width,c.height,c.crop,c.preserve_headers)},e.onresize=function(){d(this.getAsBlob(a.type,c.quality)),this.destroy()},e.onerror=function(){d(a)},e.load(a)}catch(f){d(a)}}function z(a,c,d){function j(a,b,c){var d=i[a];switch(a){case"max_file_size":"max_file_size"===a&&(i.max_file_size=i.filters.max_file_size=b);break;case"chunk_size":(b=g.parseSize(b))&&(i[a]=b);break;case"filters":"array"===g.typeOf(b)&&(b={mime_types:b}),c?g.extend(i.filters,b):i.filters=b,b.mime_types&&(i.filters.mime_types.regexp=function(a){var b=[];return g.each(a,function(a){g.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?b.push("\\.*"):b.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+b.join("|")+")$","i")}(i.filters.mime_types));break;case"resize":c?g.extend(i.resize,b,{enabled:!0}):i.resize=b;break;case"prevent_duplicates":i.prevent_duplicates=i.filters.prevent_duplicates=!!b;break;case"browse_button":case"drop_element":b=g.get(b);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":i[a]=b,c||(h=!0);break;default:i[a]=b}c||e.trigger("OptionChanged",a,b,d)}var e=this,h=!1;"object"==typeof a?g.each(a,function(a,b){j(b,a,d)}):j(a,c,d),d?(i.required_features=f(g.extend({},i)),k=f(g.extend({},i,{required_features:!0}))):h&&(e.trigger("Destroy"),x.call(e,i,function(a){a?(e.runtime=b.Runtime.getInfo(u()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}))}function A(a,b){[].push.apply(j,b),a.trigger("QueueChanged"),a.refresh()}function B(a,b){if(i.unique_names){var c=b.name.match(/\.([^.]+)$/),d="part";c&&(d=c[1]),b.target_name=b.id+"."+d}}function C(a,c){function m(){h-->0?d(n,1e3):(c.loaded=j,a.trigger("Error",{code:g.HTTP_ERROR,message:g.translate("HTTP Error."),file:c,response:q.responseText,status:q.status,responseHeaders:q.getAllResponseHeaders()}))}function n(){var o,p,r,s;c.status!=g.DONE&&c.status!=g.FAILED&&a.state!=g.STOPPED&&(r={name:c.target_name||c.name},f&&i.chunks&&l.size>f?(s=Math.min(f,l.size-j),o=l.slice(j,j+s)):(s=l.size,o=l),f&&i.chunks&&(a.settings.send_chunk_number?(r.chunk=Math.ceil(j/f),r.chunks=Math.ceil(l.size/f)):(r.offset=j,r.total=l.size)),q=new b.XMLHttpRequest,q.upload&&(q.upload.onprogress=function(b){c.loaded=Math.min(c.size,j+b.loaded),a.trigger("UploadProgress",c)}),q.onload=function(){return q.status>=400?(m(),void 0):(h=a.settings.max_retries,s<l.size?(o.destroy(),j+=s,c.loaded=Math.min(j,l.size),a.trigger("ChunkUploaded",c,{offset:c.loaded,total:l.size,response:q.responseText,status:q.status,responseHeaders:q.getAllResponseHeaders()}),"Android Browser"===b.Env.browser&&a.trigger("UploadProgress",c)):c.loaded=c.size,o=p=null,!j||j>=l.size?(c.size!=c.origSize&&(l.destroy(),l=null),a.trigger("UploadProgress",c),c.status=g.DONE,a.trigger("FileUploaded",c,{response:q.responseText,status:q.status,responseHeaders:q.getAllResponseHeaders()})):d(n,1),void 0)},q.onerror=function(){m()},q.onloadend=function(){this.destroy(),q=null},a.settings.multipart&&i.multipart?(r.name=c.target_name||c.name,q.open("post",e,!0),g.each(a.settings.headers,function(a,b){q.setRequestHeader(b,a)}),p=new b.FormData,g.each(g.extend(r,a.settings.multipart_params),function(a,b){p.append(b,a)}),p.append(a.settings.file_data_name,o),q.send(p,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:k,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})):(e=g.buildUrl(a.settings.url,g.extend(r,a.settings.multipart_params)),q.open("post",e,!0),q.setRequestHeader("Content-Type","application/octet-stream"),g.each(a.settings.headers,function(a,b){q.setRequestHeader(b,a)}),q.send(o,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:k,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})))}var l,e=a.settings.url,f=a.settings.chunk_size,h=a.settings.max_retries,i=a.features,j=0;c.loaded&&(j=c.loaded=f*Math.floor(c.loaded/f)),l=c.getSource(),a.settings.resize.enabled&&v(l,"send_binary_string")&&~b.inArray(l.type,["image/jpeg","image/png"])?y.call(this,l,a.settings.resize,function(a){l=a,c.size=a.size,n()}):n()}function D(a,b){s(b)}function E(a){if(a.state==g.STARTED)n=+new Date;else if(a.state==g.STOPPED)for(var b=a.files.length-1;b>=0;b--)a.files[b].status==g.UPLOADING&&(a.files[b].status=g.QUEUED,t())}function F(){q&&q.abort()}function G(a){t(),d(function(){r.call(a)},1)}function H(a,b){b.file&&(b.file.status=g.FAILED,s(b.file),a.state==g.STARTED&&(a.trigger("CancelUpload"),d(function(){r.call(a)},1)))}function I(a){a.stop(),g.each(j,function(a){a.destroy()}),j=[],l.length&&(g.each(l,function(a){a.destroy()}),l=[]),m.length&&(g.each(m,function(a){a.destroy()}),m=[]),k={},p=!1,n=q=null,o.reset()}var i,n,o,q,h=g.guid(),j=[],k={},l=[],m=[],p=!1;i={runtimes:b.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},z.call(this,a,null,!0),o=new g.QueueProgress,g.extend(this,{id:h,uid:h,state:g.STOPPED,features:{},runtime:null,files:j,settings:i,total:o,init:function(){var a=this;return"function"==typeof i.preinit?i.preinit(a):g.each(i.preinit,function(b,c){a.bind(c,b)}),i.browse_button&&i.url?(w.call(this),x.call(this,i,function(c){"function"==typeof i.init?i.init(a):g.each(i.init,function(b,c){a.bind(c,b)}),c?(a.runtime=b.Runtime.getInfo(u()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}),void 0):(this.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")}),void 0)},setOption:function(a,b){z.call(this,a,b,!this.runtime)},getOption:function(a){return a?i[a]:i},refresh:function(){l.length&&g.each(l,function(a){a.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=g.STARTED&&(this.state=g.STARTED,this.trigger("StateChanged"),r.call(this))},stop:function(){this.state!=g.STOPPED&&(this.state=g.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){p=arguments[0]!==c?arguments[0]:!0,l.length&&g.each(l,function(a){a.disable(p)}),this.trigger("DisableBrowse",p)},getFile:function(a){var b;for(b=j.length-1;b>=0;b--)if(j[b].id===a)return j[b]},addFile:function(a,c){function k(a,c){var d=[];b.each(f.settings.filters,function(b,c){e[c]&&d.push(function(d){e[c].call(f,b,a,function(a){d(!a)})})}),b.inSeries(d,c)}function l(a){var e=b.typeOf(a);if(a instanceof b.File){if(!a.ruid&&!a.isDetached()){if(!j)return!1;a.ruid=j,a.connectRuntime(j)}l(new g.File(a))}else a instanceof b.Blob?(l(a.getSource()),a.destroy()):a instanceof g.File?(c&&(a.name=c),h.push(function(b){k(a,function(c){c||(i.push(a),f.trigger("FileFiltered",a)),d(b,1)})})):-1!==b.inArray(e,["file","blob"])?l(new b.File(null,a)):"node"===e&&"filelist"===b.typeOf(a.files)?b.each(a.files,l):"array"===e&&(c=null,b.each(a,l))}var j,f=this,h=[],i=[];j=u(),l(a),h.length&&b.inSeries(h,function(){i.length&&f.trigger("FilesAdded",i)})},removeFile:function(a){var c,b="string"==typeof a?a:a.id;for(c=j.length-1;c>=0;c--)if(j[c].id===b)return this.splice(c,1)[0]},splice:function(a,b){var d=j.splice(a===c?0:a,b===c?j.length:b),e=!1;return this.state==g.STARTED&&(e=!0,this.stop()),this.trigger("FilesRemoved",d),g.each(d,function(a){a.destroy()}),this.trigger("QueueChanged"),this.refresh(),e&&this.start(),d},bind:function(a,b,c){var d=this;g.Uploader.prototype.bind.call(this,a,function(){var a=[].slice.call(arguments);return a.splice(0,1,d),b.apply(this,a)},0,c)},destroy:function(){this.trigger("Destroy"),i=o=null,this.unbindAll()}})},g.Uploader.prototype=b.EventTarget.instance,g.File=function(){function c(c){g.extend(this,{id:g.guid(),name:c.name||c.fileName,type:c.type||"",size:c.size||c.fileSize,origSize:c.size||c.fileSize,loaded:0,percent:0,status:g.QUEUED,lastModifiedDate:c.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var a=this.getSource().getSource();return-1!==b.inArray(b.typeOf(a),["blob","file"])?a:null},getSource:function(){return a[this.id]?a[this.id]:null},destroy:function(){var b=this.getSource();b&&(b.destroy(),delete a[this.id])}}),a[this.id]=c}var a={};return c}(),g.QueueProgress=function(){var a=this;a.size=0,a.loaded=0,a.uploaded=0,a.failed=0,a.queued=0,a.percent=0,a.bytesPerSec=0,a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},a.plupload=g}(window,mOxie);